<mvc:View
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:m="sap.m"
    xmlns:l="sap.ui.layout"
    xmlns:core="sap.ui.core"
    xmlns:unified="sap.ui.unified"
    xmlns:tnt="sap.tnt"
    xmlns:pdf="sap.m"
    id="detailView"
    controllerName="genaiprojnew.controller.Detail"
>
    <m:Page
        id="detailPage"
        class="sapUiContentPadding"
        showHeader="false"
    >
        <m:content>
            <!-- Split layout: Left (main content) + Right (file preview) -->
            <m:HBox
                width="100%"
                alignItems="Start"
            >
                <!-- LEFT SIDE: Existing Detail View -->
                <m:VBox width="60%">
                    <!-- System Message Section -->
                    <m:HBox
                        alignItems="Center"
                        class="sapUiTinyMarginBottom"
                    >
                        <m:Label
                            text="System Message"
                            design="Bold"
                            class="sapUiTinyMarginEnd"
                        />
                        <m:Input
                            id="systemMessageInput"
                            value="{appmodel>/atcSystemMessage}"
                            showValueHelp="true"
                            valueHelpRequest="onValueHelpRequest"
                        >
                            <m:layoutData>
                                <m:FlexItemData growFactor="1" />
                            </m:layoutData>
                        </m:Input>
                        <!-- Spacer: Adjust width as needed -->
                        <m:Label width="8px" />
                        <m:Button
                            icon="sap-icon://add"
                            tooltip="Add"
                            class="sapUiTinyMarginEnd"
                        />
                        <m:Button
                            id="examplebtn"
                            text="Add Example"
                            class="sapUiTinyMarginEnd"
                            press="onShowDialog"
                            tooltip="{i18n>addExamplesTooltip}"
                        />
                        <m:Button
                            icon="sap-icon://settings"
                            tooltip="Parameters"
                            class="sapUiTinyMarginEnd"
                            press="onParameterPopUp"
                        />
                    </m:HBox>
                    <m:Dialog
                        id="addexample"
                        title="Add Examples"
                        class="sapUiContentPadding"
                    >
                        <m:content>
                            <m:Title text="User :" />
                            <m:TextArea
                                id="usertextarea"
                                width="100%"
                            />
                            <m:Title text="Assistant :" />
                            <m:TextArea
                                id="assistanttextarea"
                                width="100%"
                            />
                        </m:content>
                        <m:beginButton>
                            <m:Button
                                text="Save"
                                press="onSaveDialog"
                            />
                        </m:beginButton>
                        <m:endButton>
                            <m:Button
                                text="Cancel"
                                press="onCancelDialog"
                            />
                        </m:endButton>
                    </m:Dialog>
                    <m:HBox
                        alignItems="Stretch"
                        class="sapUiTinyMarginBottom"
                    >
                        <m:TextArea
                            id="SysTextArea"
                            width="98%"
                            rows="2"
                            editable="false"
                            class="sapUiTinyMarginEnd"
                            value="{appmodel>/selectedSysMsgTemplate}"
                        >
                            <m:layoutData>
                                <m:FlexItemData growFactor="1" />
                            </m:layoutData>
                        </m:TextArea>
                        <m:VBox justifyContent="End">
                            <m:Button
                                id="editicon"
                                icon="sap-icon://edit"
                                tooltip="Edit System Message"
                                class="sapUiTinyMarginEnd"
                                press="SystemMsgSave"
                                visible="{= !${viewModel>/BS/Visible/SystemTextAreaEditable}}"
                            />
                        </m:VBox>
                    </m:HBox>

                    <m:HBox>
                        <m:VBox>
                            <m:Button
                                id="SaveBtn"
                                text="Save"
                                type="Accept"
                                press="onSystemSave"
                                visible="false"
                            />
                            <tnt:InfoLabel
                                id="InfoLabel"
                                visible="false"
                                text="Please select the 'Save' button above to apply your changes."
                                renderMode="Narrow"
                                colorScheme="1"
                            />
                        </m:VBox>
                    </m:HBox>

                    <!-- Selected File Row -->
                    <m:HBox
                        alignItems="Center"
                        class="sapUiTinyMarginBottom"
                        justifyContent="Start"
                    >
                        <m:Label
                            text="Selected File:"
                            design="Bold"
                        />
                        <m:Input
                            value="{appmodel>/selectedFileName}" 
                            editable="false"
                            width="40px"
                            class="sapUiTinyMarginEnd"
                        />
                        

                        <m:Button
                            icon="sap-icon://upload"
                            class="sapUiTinyMarginBegin"
                            press="onUploadFile"
                        />
                        
                        <m:Dialog
                        id="previewDialog"
                        title="File Preview"
                        contentWidth="60%"
                        contentHeight="80%"
                        stretch="false"
                        draggable="true"
                        resizable="true"
                        >
                        <m:VBox>
                            <pdf:PDFViewer id="dialogPdfViewer" visible="false" width="100%" height="600px" />
                            <m:Image id="dialogImagePreview" visible="false" width="100%" />
                            <m:TextArea id="dialogTextPreview" visible="false" width="100%" rows="20" />
                        </m:VBox>
                        <m:endButton>
                            <m:Button text="Close" press="onClosePreviewDialog" />
                        </m:endButton>
                    </m:Dialog>
                        <m:Button
                            text="Preview"
                            class="sapUiTinyMarginBegin"
                            press="onPreviewFile"
                        />
                        <m:Button
                            text="Files"
                            class="sapUiTinyMarginBegin"
                            press="onFilesButtonPress"
                        />
                        <m:Label
                            text="Select Model:"
                            design="Bold"
                            class="sapUiTinyMarginBegin"
                        />
                        <m:ComboBox
                            width="48%"
                            class="sapUiTinyMarginBegin"
                        >
                            <m:items>
                                <core:Item
                                    key="gpt4"
                                    text="GPT-4"
                                />
                                <core:Item
                                    key="gpt4o"
                                    text="GPT-4o"
                                />
                                <core:Item
                                    key="gpt5"
                                    text="GPT-5"
                                />
                            </m:items>
                        </m:ComboBox>
                        
                    </m:HBox>
                    <!-- RAG Toggle -->
                    <m:HBox
                        alignItems="Center"
                        justifyContent="Start"
                        class="sapUiTinyMarginBottom"
                    >
                        <m:Label
                            text="Enable Rag Search:"
                            design="Bold"
                        />
                        <m:Switch
                            state="{/ragEnabled}"
                            class="sapUiTinyMarginBegin"
                            change="onRagToggleChange"
                        />
                        <m:Label
                            text="Reference to uploaded file:"
                            design="Bold"
                            visible="{= ${/ragEnabled} }"
                            class="sapUiTinyMarginBegin"
                        />
                        <m:Switch
                            state="{/subToggleState}"
                            visible="{= ${/ragEnabled} }"
                            class="sapUiTinyMarginBegin"
                        />
                    </m:HBox>

                    <!-- Prompt Input -->
                    <m:VBox class="sapUiTinyMarginBottom">
                        <m:Label
                            text="Prompts"
                            design="Bold"
                        />
                        <m:Input
                            id="promptInput"
                            value="{appmodel>/selectedPrompt}"
                            showValueHelp="true"
                            width="50%"
                            valueHelpRequest="onValueHelpRequest"
                        />
                    </m:VBox>
                    
                    <!-- Add Your Prompt -->
                    <m:VBox class="sapUiTinyMarginBottom">
                        <m:Label
                            text="Add Your Prompt"
                            design="Bold"
                        />
                        <m:TextArea
                            rows="3"
                            width="98%"
                             value="{appmodel>/selectedPromptText}"
                            editable="true"
                        />
                    </m:VBox>
                </m:VBox>

                <!-- RIGHT SIDE: Uploaded File Content Preview with Token Limit -->
                <m:VBox
                    width="50%"
                    class="sapUiSmallMarginBegin sapUiMediumMarginEnd"
                >
                    <m:HBox
                        justifyContent="SpaceBetween"
                        alignItems="Center"
                    >
                        <m:Label
                            text="AI Response"
                            design="Bold"
                        />
                        <!-- <m:Label text="Token Limit: 0 / 128000" class="sapUiTinyMarginEnd" /> -->
                    </m:HBox>

                    <!-- <m:ScrollContainer height="400px" vertical="true" width="100%"> -->
                    <m:TextArea
                        width="105%"
                        growing="false"
                        editable="true"
                        rows="32"
                        height="400px"
                    />
                    <!-- </m:ScrollContainer> -->
                </m:VBox>
            </m:HBox>
        </m:content>
    </m:Page>
</mvc:View>
